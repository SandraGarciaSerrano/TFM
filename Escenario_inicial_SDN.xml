<?xml version="1.0" encoding="UTF-8"?>

<!--
~~~~~~~~~~~~~~~~~~~~~~
|Global scenario with SDN but only one upstream|
~~~~~~~~~~~~~~~~~~~~~~

Name:        Basic SDN scenario with one upstream interface

Description: Basic SDN scenario to test multicast with one upstream interface

Author:      Sandra Garcia

Based on: Code by Luis Bellido Triana and Raúl Álvarez Pinilla

This file is  a modiffication of the Virtual Networks over LinuX (VNX) Project 
distribution. (www: http://www.dit.upm.es/vnx - e-mail: vnx@dit.upm.es) 

Departamento de Ingenieria de Sistemas Telematicos (DIT)
Universidad Politecnica de Madrid
SPAIN
-->

<vnx xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:noNamespaceSchemaLocation="/usr/share/xml/vnx/vnx-2.00.xsd">
  <global>
    <version>2.0</version>
    <scenario_name>Escenario_inicial_SDN</scenario_name>
    <automac/>
    <!--vm_mgmt type="none" /-->
    <vm_mgmt type="private" network="10.250.0.0" mask="24" offset="0">
       <host_mapping />
    </vm_mgmt>
    <vm_defaults>
        <console id="0" display="no"/>
        <console id="1" display="yes"/>
    </vm_defaults>
  </global>

  <!-- NET DEFINITION -->
  <!-- virbr0 (192.168.122.0/24) -->
  <net name="virbr0" mode="virtual_bridge" managed="no"/>
  <!--SDN switches -->
  <net name="sw1" mode="openvswitch" controller="tcp:10.100.0.22:6633" of_version="OpenFlow13" fail_mode="secure" hwaddr="00:00:00:00:00:01"></net>

  <!-- RYU Controller -->
  <vm name="controller" type="lxc" arch="x86_64">
	<filesystem type="cow">filesystems/rootfs_lxc_ubuntu64-onos</filesystem>
	<if id="1" net="sw1">
	  <ipv4>10.100.0.22/24</ipv4>
	</if>
	<if id="9" net="virbr0">
	  <ipv4>dhcp</ipv4>
	</if>
	<shareddir root="/root/ryu">conf/Ryu</shareddir>
	<filetree seq="on_boot" root="/tmp/">conf/hosts</filetree>
    <exec seq="on_boot" type="verbatim">
    	cat /tmp/hosts >> /etc/hosts
    	rm /tmp/hosts
    </exec>
  </vm>

  <!-- Clients -->
  <vm name="client1" type="lxc" arch="x86_64">
    <filesystem type="cow">filesystems/rootfs_lxc_ubuntu64-onos</filesystem>
    <if id="1" net="sw1">
      <ipv4>10.100.0.11/24</ipv4>
    </if>
    <if id="9" net="virbr0">
      <ipv4>dhcp</ipv4>
    </if>
    <route type="ipv4" gw="10.100.0.1">10.100.0.0/16</route>    
  </vm>

  <vm name="client2" type="lxc" arch="x86_64">
    <filesystem type="cow">filesystems/rootfs_lxc_ubuntu64-onos</filesystem>
    <if id="1" net="sw1">
      <ipv4>10.100.0.12/24</ipv4>
    </if>
    <if id="9" net="virbr0">
      <ipv4>dhcp</ipv4>
    </if>
    <route type="ipv4" gw="10.100.0.1">10.100.0.0/16</route>    
  </vm>

  <vm name="client3" type="lxc" arch="x86_64">
    <filesystem type="cow">filesystems/rootfs_lxc_ubuntu64-onos</filesystem>
    <if id="1" net="sw1">
      <ipv4>10.100.0.13/24</ipv4>
    </if>
    <if id="9" net="virbr0">
      <ipv4>dhcp</ipv4>
    </if>
    <route type="ipv4" gw="10.100.0.1">10.100.0.0/16</route>    
  </vm>

  <!-- Server/Provider -->
  <vm name="server" type="lxc" arch="x86_64">
    <filesystem type="cow">filesystems/rootfs_lxc_ubuntu64-onos</filesystem>
    <if id="1" net="sw1">
      <ipv4>10.100.0.21/24</ipv4>
    </if>
    <if id="9" net="virbr0">
      <ipv4>dhcp</ipv4>
    </if>
    <route type="ipv4" gw="10.100.0.1">10.100.0.0/16</route>
  </vm>

  <!-- Host -->
  <host>
      <hostif net="sw1">
        <ipv4>10.100.0.14/24</ipv4>
      </hostif>
      <route type="ipv4" gw="10.100.0.1">10.100.0.0/16</route>
  </host>

</vnx>
